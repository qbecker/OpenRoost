This is the brain of the system. All logic is done here